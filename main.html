<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MANGA System Design Master Plan (Cloud Sync)</title>
    <style>
        :root {
            --primary: #2563eb;
            --bg: #f1f5f9;
            --surface: #ffffff;
            --text: #334155;
            --border: #e2e8f0;
            --success-bg: #dcfce7;
            --success-text: #166534;
            --link: #0284c7;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: var(--surface);
            border-radius: 16px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            position: relative;
        }

        header {
            background: #1e293b;
            color: white;
            padding: 2.5rem;
            text-align: center;
            position: relative;
        }

        h1 { margin: 0; font-size: 2rem; }
        p.subtitle { margin-top: 0.5rem; opacity: 0.8; }

        /* Settings Button */
        .settings-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            color: white;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
        }
        .settings-btn:hover { background: rgba(255,255,255,0.2); }

        /* Sync Status Indicator */
        .sync-status {
            font-size: 0.8rem;
            margin-top: 10px;
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            background: rgba(255,255,255,0.1);
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5);
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        .modal.active { display: flex; }
        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 12px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }
        .input-group { margin-bottom: 15px; }
        .input-group label { display: block; margin-bottom: 5px; font-weight: bold; }
        .input-group input { 
            width: 100%; padding: 10px; border: 1px solid var(--border); border-radius: 6px; box-sizing: border-box;
        }
        .btn-save {
            background: var(--primary); color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; width: 100%; font-size: 1rem;
        }

        /* Progress Bar */
        .progress-section {
            padding: 20px 30px;
            background: #f8fafc;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            gap: 20px;
        }
        .progress-track {
            flex-grow: 1; height: 12px; background: #e2e8f0; border-radius: 6px; overflow: hidden;
        }
        .progress-fill {
            height: 100%; background: var(--primary); width: 0%; transition: width 0.5s;
        }

        /* Tabs */
        .tabs { display: flex; border-bottom: 1px solid var(--border); background: #f8fafc; overflow-x: auto; }
        .tab-btn {
            flex: 1; padding: 1.2rem; border: none; background: none; cursor: pointer; font-weight: 600; color: #64748b; white-space: nowrap;
            border-bottom: 4px solid transparent;
        }
        .tab-btn.active { background: var(--surface); color: var(--primary); border-bottom-color: var(--primary); }

        /* Tables */
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        table { width: 100%; border-collapse: collapse; min-width: 600px; }
        .table-wrapper { overflow-x: auto; }
        
        th, td { padding: 16px 24px; text-align: left; border-bottom: 1px solid var(--border); vertical-align: top; }
        th { background: #f1f5f9; position: sticky; top: 0; font-size: 0.8rem; text-transform: uppercase; color: #475569; }

        tr.done-row { background-color: var(--success-bg); }
        .status-badge {
            padding: 4px 12px; border-radius: 12px; font-size: 0.85rem; font-weight: bold; background: #e2e8f0; color: #64748b; white-space: nowrap;
        }
        .status-badge.complete { background: #22c55e; color: white; }

        /* Tasks */
        .task-list { list-style: none; padding: 0; margin: 0; }
        .task-item { display: flex; gap: 10px; margin-bottom: 8px; font-size: 0.95rem; }
        input[type="checkbox"] { margin-top: 5px; width: 18px; height: 18px; accent-color: var(--primary); flex-shrink: 0; }
        .resource-link { color: var(--link); text-decoration: none; background: #e0f2fe; padding: 2px 8px; border-radius: 12px; font-size: 0.85rem; font-weight: 600; display: inline-block; margin: 2px; }

    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>System Design Grind</h1>
        <p class="subtitle">Cloud Synced via GitHub Gist</p>
        <button class="settings-btn" onclick="toggleModal()">‚öôÔ∏è Sync Settings</button>
        <div id="syncStatus" class="sync-status">‚ö†Ô∏è Offline / Not Configured</div>
    </header>

    <div class="progress-section">
        <span>Progress:</span>
        <div class="progress-track"><div class="progress-fill" id="globalProgress"></div></div>
        <div class="progress-stat" id="globalProgressText">0%</div>
    </div>

    <div class="tabs">
        <button class="tab-btn active" onclick="openTab('phase1')">Phase 1: Fundamentals</button>
        <button class="tab-btn" onclick="openTab('phase2')">Phase 2: Components</button>
        <button class="tab-btn" onclick="openTab('phase3')">Phase 3: Architecture</button>
    </div>

    <div id="phase1" class="tab-content active"><div class="table-wrapper"><table><tbody id="phase1-body"></tbody></table></div></div>
    <div id="phase2" class="tab-content"><div class="table-wrapper"><table><tbody id="phase2-body"></tbody></table></div></div>
    <div id="phase3" class="tab-content"><div class="table-wrapper"><table><tbody id="phase3-body"></tbody></table></div></div>
</div>

<div id="configModal" class="modal">
    <div class="modal-content">
        <h2>Sync Settings</h2>
        <p style="font-size: 0.9rem; color: #666;">To enable sync across devices, create a <strong>GitHub Gist</strong> and a <strong>Personal Access Token (with 'gist' scope)</strong>.</p>
        
        <div class="input-group">
            <label>Gist ID (from URL)</label>
            <input type="text" id="gistIdInput" placeholder="e.g. 8f4b2..." />
        </div>
        <div class="input-group">
            <label>GitHub Token (PAT)</label>
            <input type="password" id="tokenInput" placeholder="ghp_..." />
        </div>
        <button class="btn-save" onclick="saveConfig()">Save & Sync</button>
        <p style="margin-top:10px; font-size:0.8rem; color:#ef4444;">Warning: Your token is saved in your browser's LocalStorage. Do not use on public computers.</p>
    </div>
</div>

<script>
    // --- CONFIG & STATE ---
    let appState = {}; 
    let GIST_ID = localStorage.getItem('sd_gist_id') || '';
    let GH_TOKEN = localStorage.getItem('sd_gh_token') || '';
    
    // --- DATA STRUCTURE ---
    const ghRepo = "https://github.com/donnemartin/system-design-primer";
    const google = (q) => `https://www.google.com/search?q=${encodeURIComponent(q)}`;
    
    // Same data as before, compacted for brevity in this view
    const data = {
        phase1: [
            { w: "W1", focus: "Scalability Basics", res: [{t:"DDIA: Ch 1", u:google("DDIA Ch 1")}], tasks: ["Explain Vertical vs Horizontal scaling", "Calculate latency: Memory vs Disk vs Network", "Memorize 'Power of 2' approximations"] },
            { w: "W2", focus: "Load Balancing & Caching", res: [{t:"GH: Load Balancer", u:ghRepo+"#load-balancer"}], tasks: ["Configure NGINX locally", "Draw diagram: Where do caches sit?", "Explain LRU vs LFU"] },
            { w: "W3", focus: "Database Internals", res: [{t:"DDIA: Ch 3", u:google("DDIA Ch 3")}], tasks: ["Explain SSTables vs B-Trees", "Perform ACID transaction in PostgreSQL", "List 3 scenarios NoSQL beats SQL"] },
            { w: "W4", focus: "Replication & Sharding", res: [{t:"DDIA: Ch 5", u:google("DDIA Ch 5")}], tasks: ["Explain Leader-Follower replication", "Design sharding key strategy", "Explain 'Hot Shard' problem"] },
            { w: "W5", focus: "CAP & Consistency", res: [{t:"GH: CAP", u:ghRepo+"#cap-theorem"}], tasks: ["Map DBs to CAP triangle", "Write race condition code", "Explain Eventual Consistency"] },
            { w: "W6", focus: "Protocols", res: [{t:"GH: Comms", u:ghRepo+"#communication"}], tasks: ["Compare Polling vs WebSockets", "Protocol Buffers vs JSON", "GraphQL vs REST"] },
            { w: "W7", focus: "Async Processing", res: [{t:"GH: Queues", u:ghRepo+"#message-queues"}], tasks: ["RabbitMQ vs Kafka", "Draw async upload flow", "Explain Backpressure"] },
            { w: "W8", focus: "Review", res: [{t:"Practice", u:"#"}], tasks: ["Design URL Shortener DB", "Review Trade-offs", "Clear W1-W7 tasks"] }
        ],
        phase2: [
            { w: "W9", focus: "Consistent Hashing", res: [{t:"Dynamo Paper", u:google("Amazon Dynamo Paper")}], tasks: ["Implement Consistent Hashing ring", "Explain Virtual Nodes", "Summarize Vector Clocks"] },
            { w: "W10", focus: "ID Gen & Rate Limiters", res: [{t:"Stripe Blog", u:google("Stripe Rate Limiter")}], tasks: ["UUID vs Snowflake", "Design Redis Rate Limiter", "Token Bucket vs Leaky Bucket"] },
            { w: "W11", focus: "Crawlers & Search", res: [{t:"GH: Crawler", u:ghRepo+"#design-a-web-crawler"}], tasks: ["Explain Politeness", "Design Trie for Autocomplete", "Bloom Filters explanation"] },
            { w: "W12", focus: "Dist. Caching", res: [{t:"Memcache Paper", u:google("Facebook Memcached Paper")}], tasks: ["Thundering Herd problem", "Hot Key solution", "Cache Aside vs Write Through"] },
            { w: "W13", focus: "Dist. File Systems", res: [{t:"GFS Paper", u:google("GFS Paper")}], tasks: ["Read vs Write flow in GFS", "Block vs Object Storage", "HDFS small file problem"] },
            { w: "W14", focus: "Chat Systems", res: [{t:"GH: Chat", u:ghRepo+"#design-a-chat-application"}], tasks: ["Schema: 1v1 vs Group", "User Typing feature", "Offline delivery handling"] },
            { w: "W15", focus: "Consensus", res: [{t:"ZooKeeper", u:google("Apache ZooKeeper")}], tasks: ["Split Brain scenario", "Why Leader Election?", "Paxos/Raft high level"] },
            { w: "W16", focus: "Review", res: [{t:"Latency #s", u:google("Latency numbers per year")}], tasks: ["Design Rate Limiter + ID Gen + Cache", "Review Latency Numbers", "Clear W9-W15 tasks"] }
        ],
        phase3: [
            { w: "W17", focus: "Twitter", res: [{t:"GH: Twitter", u:ghRepo+"#design-a-timeline"}], tasks: ["Fan-out Write vs Read", "Schema: User/Tweet/Follow", "Storage calc for 500M tweets"] },
            { w: "W18", focus: "Netflix", res: [{t:"Netflix Blog", u:google("Netflix Tech Blog")}], tasks: ["Upload path architecture", "Viral traffic spikes", "Adaptive Bitrate Streaming"] },
            { w: "W19", focus: "WhatsApp", res: [{t:"GH: WhatsApp", u:ghRepo+"#design-a-chat-application"}], tasks: ["Last Seen mechanism", "Multi-device sync", "Message history storage"] },
            { w: "W20", focus: "Uber", res: [{t:"Uber Blog", u:google("Uber Tech Blog")}], tasks: ["Rider/Driver matching", "Surge Pricing concurrency", "Geospatial indexing (Quadtree)"] },
            { w: "W21", focus: "Amazon", res: [{t:"Idempotency", u:google("Idempotency in API")}], tasks: ["Checkout Inventory Lock", "Handle payment failure", "Exactly Once processing"] },
            { w: "W22", focus: "Mock (Peer)", res: [{t:"Pramp", u:"https://www.pramp.com"}], tasks: ["3 Peer Mocks", "Focus: Timing", "Communication feedback"] },
            { w: "W23", focus: "Mock (Hard)", res: [{t:"Constraints", u:"#"}], tasks: ["3 Mocks with constraints", "Design Enterprise Twitter", "Focus: Requirements"] },
            { w: "W24", focus: "Final", res: [{t:"Resume", u:"#"}], tasks: ["Prepare War Stories", "Memorize Latency #s", "Rest"] }
        ]
    };

    // --- GIST SYNC LOGIC ---

    async function loadFromGist() {
        const statusEl = document.getElementById('syncStatus');
        if (!GIST_ID || !GH_TOKEN) {
            statusEl.innerText = "‚ö†Ô∏è Local Mode (Settings to Sync)";
            // Load local backup if exists
            const local = localStorage.getItem('sd_local_backup');
            if(local) appState = JSON.parse(local);
            renderAll();
            return;
        }

        statusEl.innerText = "üîÑ Syncing...";
        
        try {
            const res = await fetch(`https://api.github.com/gists/${GIST_ID}`, {
                headers: { 
                    'Authorization': `token ${GH_TOKEN}`,
                    'Accept': 'application/vnd.github.v3+json'
                }
            });

            if (!res.ok) throw new Error("Auth Failed");
            
            const gist = await res.json();
            const file = gist.files['progress.json'];
            
            if (file) {
                appState = JSON.parse(file.content);
                statusEl.innerText = "‚úÖ Synced";
                statusEl.style.background = "rgba(22, 101, 52, 0.2)";
            } else {
                // First time initialization
                appState = {};
                statusEl.innerText = "‚úÖ Connected (New Gist)";
            }
            renderAll();
            localStorage.setItem('sd_local_backup', JSON.stringify(appState));
        } catch (e) {
            console.error(e);
            statusEl.innerText = "‚ùå Sync Error (Check Token)";
            statusEl.style.background = "rgba(239, 68, 68, 0.2)";
        }
    }

    async function saveToGist() {
        // Optimistic UI update first
        renderAll();
        localStorage.setItem('sd_local_backup', JSON.stringify(appState));

        if (!GIST_ID || !GH_TOKEN) return;

        const statusEl = document.getElementById('syncStatus');
        statusEl.innerText = "‚òÅÔ∏è Saving...";

        try {
            await fetch(`https://api.github.com/gists/${GIST_ID}`, {
                method: 'PATCH',
                headers: { 
                    'Authorization': `token ${GH_TOKEN}`,
                    'Accept': 'application/vnd.github.v3+json'
                },
                body: JSON.stringify({
                    files: {
                        "progress.json": { content: JSON.stringify(appState) }
                    }
                })
            });
            statusEl.innerText = "‚úÖ Saved";
        } catch (e) {
            statusEl.innerText = "‚ùå Save Failed";
        }
    }

    // --- UI LOGIC ---

    function renderAll() {
        ['phase1', 'phase2', 'phase3'].forEach(p => renderPhase(p, data[p]));
        updateGlobalProgress();
    }

    function renderPhase(phaseId, weekData) {
        const tbody = document.getElementById(phaseId + '-body');
        tbody.innerHTML = ''; // Clear

        // Header Row
        const headerRow = document.createElement('tr');
        headerRow.innerHTML = `<th>WK</th><th>FOCUS</th><th>RESOURCES</th><th>TASKS</th><th style="text-align:center">STATUS</th>`;
        tbody.appendChild(headerRow);

        weekData.forEach((week, wIndex) => {
            const tr = document.createElement('tr');
            
            let tasksHtml = `<ul class="task-list">`;
            let completedCount = 0;

            week.tasks.forEach((task, tIndex) => {
                const taskId = `${phaseId}-w${wIndex}-t${tIndex}`;
                const isChecked = appState[taskId] === true;
                if(isChecked) completedCount++;

                tasksHtml += `
                    <li class="task-item">
                        <input type="checkbox" ${isChecked ? 'checked' : ''} 
                            onchange="toggleTask('${taskId}')">
                        <span>${task}</span>
                    </li>`;
            });
            tasksHtml += `</ul>`;

            const resHtml = week.res.map(r => `<a href="${r.u}" target="_blank" class="resource-link">${r.t}</a>`).join(' ');
            
            const isDone = completedCount === week.tasks.length && week.tasks.length > 0;
            if(isDone) tr.classList.add('done-row');

            tr.innerHTML = `
                <td>${week.w}</td>
                <td style="font-weight:600">${week.focus}</td>
                <td>${resHtml}</td>
                <td>${tasksHtml}</td>
                <td style="text-align:center">
                    <span class="status-badge ${isDone ? 'complete' : ''}">
                        ${isDone ? 'DONE' : `${completedCount}/${week.tasks.length}`}
                    </span>
                </td>
            `;
            tbody.appendChild(tr);
        });
    }

    function toggleTask(taskId) {
        appState[taskId] = !appState[taskId];
        saveToGist();
    }

    function updateGlobalProgress() {
        let total = 0, done = 0;
        ['phase1', 'phase2', 'phase3'].forEach(p => {
            data[p].forEach((week, wIndex) => {
                week.tasks.forEach((_, tIndex) => {
                    total++;
                    if(appState[`${p}-w${wIndex}-t${tIndex}`]) done++;
                });
            });
        });
        const pct = total === 0 ? 0 : Math.round((done / total) * 100);
        document.getElementById('globalProgress').style.width = pct + '%';
        document.getElementById('globalProgressText').innerText = pct + '%';
    }

    // --- SETTINGS ---
    function toggleModal() {
        const m = document.getElementById('configModal');
        m.classList.toggle('active');
        if(m.classList.contains('active')) {
            document.getElementById('gistIdInput').value = GIST_ID;
            document.getElementById('tokenInput').value = GH_TOKEN;
        }
    }

    function saveConfig() {
        GIST_ID = document.getElementById('gistIdInput').value.trim();
        GH_TOKEN = document.getElementById('tokenInput').value.trim();
        localStorage.setItem('sd_gist_id', GIST_ID);
        localStorage.setItem('sd_gh_token', GH_TOKEN);
        toggleModal();
        loadFromGist();
    }

    function openTab(tabName) {
        document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
        document.getElementById(tabName).classList.add('active');
        // Simple active button logic
        const btns = document.querySelectorAll('.tab-btn');
        if(tabName.includes('1')) btns[0].classList.add('active');
        if(tabName.includes('2')) btns[1].classList.add('active');
        if(tabName.includes('3')) btns[2].classList.add('active');
    }

    // Init
    loadFromGist();

</script>
</body>
</html>
